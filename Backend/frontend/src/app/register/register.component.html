<div *ngIf="toastMessage" class="toast" [ngClass]="toastType">
  {{ toastMessage }}
</div>

<div class="container">

  <!-- Registration Card -->
  <div class="card" *ngIf="showRegisterBox && !isSubmitting">
    <div class="header-section">
      <h1 class="title">Create Your Account</h1>
      <p class="subtitle">Join us and start your journey!</p>
    </div>
    <form class="registration-form" (ngSubmit)="onSubmit()" #regForm="ngForm">
      <div class="form-grid">
        <div class="input-group">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" name="firstName" [(ngModel)]="formData.firstName" required placeholder="e.g., John">
        </div>
        <div class="input-group">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" name="lastName" [(ngModel)]="formData.lastName" required placeholder="e.g., Doe">
        </div>
      </div>
      <div class="input-group">
        <label for="username">Username</label>
        <input type="text" id="username" name="username" [(ngModel)]="formData.username" required placeholder="Choose a unique username">
      </div>
      <div class="input-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" [(ngModel)]="formData.email" required placeholder="you@example.com">
      </div>
      <div class="form-grid">
        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" [(ngModel)]="formData.password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <div class="input-group">
          <label for="confirmPassword">Confirm Password</label>
          <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
      </div>
       <button type="submit" class="submit-btn">Create Account</button>
      <div class="login-section">
        Already have an account? <a routerLink="/login">Login here</a>
      </div>
    </form>
  </div>

  <!-- Loading Spinner Card -->
  <div class="card loading-card" *ngIf="isSubmitting">
    <div class="spinner"></div>
    <p class="loading-text">Creating Your Account...</p>
  </div>


  <!-- Verification Card with Animation State -->
  <div class="card verification-card" *ngIf="showVerifyBox">
      <!-- Success Animation View -->
      <div *ngIf="verificationStatus === 'verified'">
        <div class="verification-success">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h2>Verified!</h2>
            <p>Get ready to set up your profile.</p>
        </div>
      </div>

      <!-- Verification Form View -->
      <div *ngIf="verificationStatus !== 'verified'">
        <div class="vmodal-form">
            <h2>Verify Your Email</h2>
            <p>A 6-digit code has been sent to <strong>{{ submittedEmail }}</strong></p>
            <div class="vinput-group">
                <label for="verificationCode">Verification Code</label>
                <input type="text" id="verificationCode" [(ngModel)]="verificationCode"
                       maxlength="6" placeholder="------"
                       [class.error-shake]="verificationStatus === 'failed'">
            </div>
            <p class="error-text">{{ errorMessage }}</p>
            <button class="vsubmit-btn" (click)="onVerify()" [disabled]="verificationStatus === 'verifying'">
                <span *ngIf="verificationStatus === 'idle' || verificationStatus === 'failed'">Verify</span>
                <span *ngIf="verificationStatus === 'verifying'">Verifying...</span>
            </button>
        </div>
      </div>
  </div>


  <!-- Modern Customization Card -->
  <div class="card" *ngIf="showCustomizeBox">
      <div class="customize-header">
        <h2>Customize Your Profile</h2>
        <p>Make your profile stand out!</p>
      </div>
      <div class="banner-upload">
          <img [src]="bannerPreview" class="banner-preview" alt="Banner Preview">
          <label for="banner-input" class="upload-label banner-label">
              <span>Change Banner</span>
          </label>
          <input id="banner-input" type="file" (change)="onFileSelected($event, 'banner')" accept="image/*" style="display: none;">
      </div>
      <div class="profile-pic-section">
          <div class="pic-preview-wrapper">
              <img [src]="profilePicPreview" class="pic-preview" alt="Profile Preview">
              <label for="profile-pic-input" class="upload-label pic-label">
                <span>ðŸ“·</span>
              </label>
              <input id="profile-pic-input" type="file" (change)="onFileSelected($event, 'profile')" accept="image/*" style="display: none;">
          </div>
      </div>
      
      <!-- DOB aur Gender yahan add kiye hain -->
      <div class="form-grid">
        <div class="input-group">
          <label for="dob">Date of Birth</label>
          <input type="date" id="dob" name="date" [(ngModel)]="customizationData.date" required>
        </div>
        <div class="input-group">
          <label for="gender">Gender</label>
          <select id="gender" name="gender" [(ngModel)]="customizationData.gender" required>
            <option value="" disabled selected>Select gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
      
      <div class="input-group">
          <label>Bio</label>
          <textarea [(ngModel)]="customizationData.bio" placeholder="Tell the world a bit about yourself..."></textarea>
      </div>
      <button (click)="onCustomize()" class="submit-btn">Save & Continue</button>
  </div>

</div>

